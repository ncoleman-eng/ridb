bundle:
  name: "RIDB_Medallion"

variables:
  catalog_prefix:
    description: "Prefix for catalog name based on target"
    default: ""

include:
  - resources/*.yml
  - resources/*/*.yml

resources:
  jobs:
    reservations_pipeline:
      name: reservations-pipeline
      tasks:
        - task_key: bronze-reservations-ingest
          notebook_task:
            notebook_path: /Repos/RIDB
              Project/ridb/RIDB_Medallion/src/bronze/Bronze-Reservations
            source: WORKSPACE
        - task_key: Date_Dim
          notebook_task:
            notebook_path: /Repos/RIDB Project/ridb/RIDB_Medallion/src/gold/Date_Dim
            source: WORKSPACE
        - task_key: silver-reservations-transformations
          depends_on: 
            - task_key: bronze-reservations-ingest
          pipeline_task:
            pipeline_id: ${resources.pipelines.pipeline_reservations_transformations.id}
            full_refresh: true          
      queue:
        enabled: true
      parameters:
        - name: catalog_prefix
          default: ${var.catalog_prefix}
      performance_target: PERFORMANCE_OPTIMIZED
  
  pipelines:
    pipeline_reservations_transformations:
      name: reservations-transformations
      configuration:
        catalog_prefix: ${var.catalog_prefix}
      libraries:
        - glob:
            include: /Repos/RIDB
              Project/ridb/RIDB_Medallion/pipeline-src/reservations-transformations/transformations/**       
      schema: silver
      continuous: false
      development: false
      photon: true
      channel: CURRENT
      catalog: ${var.catalog_prefix}ridb
      serverless: true
      root_path: /Repos/RIDB
        Project/ridb/RIDB_Medallion/pipeline-src/reservations-transformations

targets:
  dev:
    mode: development
    default: true
    resources:
        jobs:
          reservations_pipeline:
            schedule:
              quartz_cron_expression: 00 55 12 * * ?
              timezone_id: America/Chicago
              pause_status: UNPAUSED            
        pipelines:
          pipeline_reservations_transformations:
            name: reservations-transformations
            development: true                                    
    variables:
      catalog_prefix: "dev_"
    workspace:
      host: https://dbc-fa9371a2-3e62.cloud.databricks.com


  prod:
    mode: production
    resources:
      jobs:
        reservations_pipeline:
          name: reservations-pipeline
          schedule:
            quartz_cron_expression: 00 55 12 * * ?
            timezone_id: America/Chicago
            pause_status: UNPAUSED          
      pipelines:
          pipeline_reservations_transformations:
            name: reservations-transformations
            schema: silver
    variables:
      catalog_prefix: "prod_"
    workspace:
      host: https://dbc-fa9371a2-3e62.cloud.databricks.com
      root_path: /Users/ncoleman51390@gmail.com/.bundle/${bundle.name}/${bundle.target}
    run_as:
      user_name: ncoleman51390@gmail.com